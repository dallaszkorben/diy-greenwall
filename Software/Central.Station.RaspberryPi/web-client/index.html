<meta content="text/html;charset=utf-8" http-equiv="Content-Type">

<!--
user-scalable=no	-disable user zoom on mobile
-->
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=0.55">

<html>
<head>

<style>

    #errormessage {
        color: red;
        font-weight: bold;
    }

    #roundslider .rs-range-color  {
        background: radial-gradient(ellipse at bottom, rgba(0, 0, 0, 1) 0%, rgba(48, 7, 36, 1) 34%, rgba(255, 255, 255, 1) 66%, rgba(0, 0, 0, 1) 100%);
    }
    #roundslider .rs-path-color  {
        background: radial-gradient(ellipse at bottom, rgba(255, 255, 255, 1) 0%, rgba(169, 173, 174, 1) 34%, rgba(255, 255, 255, 1) 66%, rgba(5, 0, 0, 1) 100%);
    }
    #roundslider .rs-handle  {
        background: radial-gradient(ellipse at center, rgba(228, 228, 228, 1) 0%, rgba(179, 179, 179, 1) 34%, rgb(102, 91, 98) 100%);
    }
    #roundslider .rs-border  {
        border-color: white;
    }

</style>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
<script src="script/jquery-3.6.0.min.js"></script>
<script src="script/roundslider.min.js"></script>
<link href="script/roundslider.min.css" rel="stylesheet" />
<!--<link href="script/button.css" rel="stylesheet" />-->
<link href="script/linearslider.css" rel="stylesheet" />

<link href="script/roundbutton/css/style.css" rel="stylesheet" />


<script>

    // ================================================
    //
    // Eanble/Disable Controllers on the screen
    //
    // ================================================
    function enableControllers(enable){

        if (enable){
            $("#roundslider").roundSlider('enable', true );

            // enable the Down10 button again
            $("#buttonDown10").css("pointer-events", "auto");
            $("#buttonDown10").css("opacity", "1.0");

            // enable the Up10 button again
            $("#buttonUp10").css("pointer-events", "auto");
            $("#buttonUp10").css("opacity", "1.0");


        }else{
            $("#roundslider").roundSlider('disable', true );
            // equivalent solution
            //$("#roundslider").data("roundSlider").disable();

            // disable the Down10 button
            $("#buttonDown10").css("pointer-events", "none");
            $("#buttonDown10").css("opacity", "0.3");

            // disable the Up10 button
            $("#buttonUp10").css("pointer-events", "none");
            $("#buttonUp10").css("opacity", "0.3");

        }


    }

    // ================================================
    //
    // refresh the value according to the actual status
    //
    // ================================================
    function refreshValues(){
        $.ajax({type: "GET", url: "/info/actuatorId/1", async: false,
            success: function(result){
                jsonResult=JSON.parse(result);
                currentValue = jsonResult.value.current;
                isThreadInProgress = jsonResult.thread.inProgress

                if(isThreadInProgress){
                    enableControllers(false);
                }else{
                    enableControllers(true);
                }

//                $("#value").html(jsonResult.current);

                // disable the change listener on roundSlider until I refresh the value
                $("#roundslider").roundSlider({change: null})

                // set the current value to the roundSlider
                $("#roundslider").roundSlider('setValue', currentValue)
                // equivalent solution
                //$("#roundslider").data("roundSlider").setValue(currentValue);

                // enable the change listener on roundSlider after the value refresh
                $("#roundslider").roundSlider({change: sliderChangeListener})

                $("#errormessage").html("");
            },
            error: function(xhr,status,error){
                $("#value").html("");
                $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
            }
        });
    }

    // ================================================
    //
    // Change listener for roundSlider
    //
    // ================================================
    function sliderChangeListener(args){
        sliderValue = parseInt(args.value)
        //delay = parseInt($("#delay").val())
        delay = parseInt($("#durationslider").val())

        $.ajax({type: "POST", url: "/gradually/set", data: {actuatorId:1, value:sliderValue, inSeconds:delay}, async: true, 
            success: function(result){
            },
            error: function(xhr,status,error){
                $("#value").html("");
                $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
            }
        });
    };


    $(document).ready(function(){

        //-----------------------
        // Control UP button click
        //-----------------------
        $("#buttonUp10").click(function(){
            delay = parseInt($("#durationslider").val());
            $.ajax({type: "POST", url: "/gradually/increase", data: {actuatorId:1, stepValue:10, inSeconds:delay}, async: true, 
                success: function(result){
                    //jsonResult=JSON.parse(result);
                    //$("#value").html(jsonResult.value);
                    //$("#slider").val(jsonResult.value);
                },
                error: function(xhr,status,error){
                    $("#value").html("");
                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
                }
            });


        });

        //-----------------------
        // Control DOWN button click
        //-----------------------
        $("#buttonDown10").click(function(){
            delay = parseInt($("#durationslider").val());
            $.ajax({type: "POST", url: "/gradually/increase", data: {actuatorId:1, stepValue:-10, inSeconds:delay}, async: true, 
                success: function(result){

                },
                error: function(xhr,status,error){
                    $("#value").html("");
                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
                }
            });
        });


        //-----------------------
        // Control TURN button click
        //-----------------------
        $("#buttonReverse").click(function(){
            $.ajax({type: "POST", url: "/immediately/reverse", data: {actuatorId:1}, async: true, 
                success: function(result){
                    jsonResult=JSON.parse(result);
                    $("#value").html(jsonResult.value);

                    $("#slider").val(jsonResult.value);
                    //$("#slider").slider("refresh");
                    //$("#slider").slider("value", jsonResult.value);
                },
                error: function(xhr,status,error){
                    $("#value").html("");
                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
                }
            });
        });


        //----------------------------------
        // Round SLIDER
        //----------------------------------
        $("#roundslider").roundSlider({
            radius: 310,
            width: 60,
            handleSize: "+0", 
            sliderType: "min-range",
            value: 0,
            circleShape: "half",	//pie/half/full/quearter
            startAngle: 0,
            handleSize: "60,60",	//Optional
            editableTooltip: true,	//Optional
            min: 0,			//Optional
            max: 100,			//Optional
            step: 1,			//Optional
            //drag: function(args){

            change: sliderChangeListener

        });
        roundslider.tooltip.css("font-size", 100);
        roundslider.tooltip.css("font-weight", "bold");


        //-----------------------
        // Initialize Slider
        //-----------------------
        refreshValues();
        setInterval(refreshValues, 3000);

    });
</script>
</head>
<body>

<table  widht="100%" style="border:0px solid black;margin-left:auto;margin-right:auto;">
<tr>
<td style="padding:10px">

<table border="0"  style="">

    <!-- Page header -->
    <thead >
        <tr>
<!--            <th colspan="3" style='text-aligh: center; font-size:60px''><div>Lamp</div></th> --><br><br>
        </tr>
    </thead>

    <tr>
        <td colspan="3" align="center" style="padding-left:10px; padding-right:10px">

            <div class="slidecontainer">
                <input type="range" min="0" max="60" value="0" step="1" class="slider" id="durationslider" list="tickmarks">
                    <div id="tickmarks">
                        <p>0</p>
                        <p>5</p>
                        <p>10</p>
                        <p>15</p>
                        <p>20</p>
                        <p>25</p>
                        <p>30</p>
                        <p>35</p>
                        <p>40</p>
                        <p>45</p>
                        <p>50</p>
                        <p>55</p>
                        <p>60</p>
                    </div>
                </input>
            </div>

        </td>
    </tr>


    <tr>
        <td colspan="3">
            <div id="roundslider" class="roundslider"></div>
        </td>
    </tr>

    <tr height="30">
    </tr>

    <tr class="nav">
        <td>
            <div id="divDown10" >
                <a href="#" id="buttonDown10" class="icon-down" ></a>
            </div>
        </td>

        <td rowspan="1">
            <div id="divReverse" >
                <a href="#" id="buttonReverse" class="icon-reverse"></a>

            </div>
        </td>

        <td>
            <div id="divUp10" >
                <a href="#" id="buttonUp10" class="icon-up" ></a>
            </div>
        </td>
    </tr>

</table>

</td>
</tr>
</table>

</div>

<div id="errormessage"></div>



</body>
</html>