<meta content="text/html;charset=utf-8" http-equiv="Content-Type">

<!--
user-scalable=no	-disable user zoom on mobile
-->
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=0.55">

<html>
<head>

    <title>Green Wall</title>

<style>

    #errormessage {
        color: red;
        font-weight: bold;
    }

    #labelstationid {
        display: inline-block;
        white-space: nowrap;
        font-family: Verdana;
        font-size: 18pt;
        font-weight: bold;
        -moz-transform: rotate(-90deg);
        -moz-transform-origin: center center;
        -webkit-transform: rotate(-90deg);
        -webkit-transform-origin: center center;
        -ms-transform: rotate(-90deg);
        -ms-transform-origin: center center;
    }

</style>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
<script src="script/jquery-3.6.0.min.js"></script>
<script src="script/roundslider.min.js"></script>
<link href="script/roundslider.min.css" rel="stylesheet" />
<!--<link href="script/button.css" rel="stylesheet" />-->
<link href="script/linearslider.css" rel="stylesheet" />

<link href="script/roundbutton/css/style.css" rel="stylesheet" />


<script>

    // ================================================
    //
    // Eanble/Disable Controllers on the screen
    //
    // ================================================
    function enableControllers(enable){

        if (enable){
            $("#roundslider").roundSlider('enable', true );

            // enable the Down10 button again
            $("#buttonDown10").css("pointer-events", "auto");
            $("#buttonDown10").css("opacity", "1.0");

            // enable the Up10 button again
            $("#buttonUp10").css("pointer-events", "auto");
            $("#buttonUp10").css("opacity", "1.0");


        }else{
            $("#roundslider").roundSlider('disable', true );
            // equivalent solution
            //$("#roundslider").data("roundSlider").disable();

            // disable the Down10 button
            $("#buttonDown10").css("pointer-events", "none");
            $("#buttonDown10").css("opacity", "0.3");

            // disable the Up10 button
            $("#buttonUp10").css("pointer-events", "none");
            $("#buttonUp10").css("opacity", "0.3");

        }


    }


    // ================================================
    //
    // Change listener for roundSlider
    //
    // ================================================
    function sliderChangeListener(args){
        sliderValue = parseInt(args.value)
        //delay = parseInt($("#delay").val())
        delay = parseInt($("#durationslider").val())

        $.ajax({type: "POST", url: "/gradually/set", data: {actuatorId:1, value:sliderValue, inSeconds:delay}, async: true, 
            success: function(result){
            },
            error: function(xhr,status,error){
                $("#value").html("");
                $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
            }
        });
    };

































    // ================================================
    //
    // refresh the graphs
    //
    // ================================================
    function refreshGraphs(){
        $.ajax({type: "GET", url: "http://192.168.0.104:5000/info/graph/startDate/2021.11.16", async: true,
            success: function(result){

                res = result.result

                if(res == "OK"){

                    var tableBody = $('<table border="1"></table>').append($("<tbody>"));

                    graphs = result.graphs;
                    $.map(graphs,function(graph){
                        stationId = graph.stationId;
                        levelPath = graph.levelPath;
                        temperaturePath = graph.temperaturePath;
                        humidityPath = graph.humidityPath;

                        row = $('<tr>');

                        // StationId
                        rowData = $('<td>');
                        stationIdField = $('<dev id="labelstationid"></dev>').append(stationId);
                        rowData.html(stationIdField);

                        row.append(rowData);


                        // Level
                        rowData = $('<td>');
                        if(levelPath != null){
                            // Tricky solution to clean the image cache
                            rowData = rowData.html('<img src="' + levelPath + '?v=' + (new Date()).getTime() + '" alt="can not find image">');
                        }
                        row.append(rowData);

                        // Temperature
                        rowData = $('<td>');
                        if(temperaturePath != null){
                            // Tricky solution to clean the image cache
                            rowData = rowData.html('<img src="' + temperaturePath + '?v=' + (new Date()).getTime() + '" alt="can not find image">');
                        }
                        row.append(rowData);

                        // Humidity
                        rowData = $('<td>');
                        if(humidityPath != null){
                            // Tricky solution to clean the image cache
                            rowData = rowData.html('<img src="' + humidityPath + '?v=' + (new Date()).getTime() + '" alt="can not find image">');
                        }
                        row.append(rowData);

                        tableBody.append(row);
                    });


                    $('#graphTableDiv').html("");
                    $('#graphTableDiv').append(tableBody);

                }else{
                    $("#value").html("");
                    $("#errormessage").html("something went wrong");
                }

                $("#errormessage").html("");
            },
            error: function(xhr,status,error){
                $("#value").html("");
                $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
            }
        });
    }

    // ================================================
    //  When the page is loaded
    // ================================================
    $(document).ready(function(){

        //-----------------------
        // Control TURN button click
        //-----------------------
        $("#buttonReverse").click(function(){
            $.ajax({type: "POST", url: "/immediately/reverse", data: {actuatorId:1}, async: true, 
                success: function(result){
                    jsonResult=JSON.parse(result);
                    $("#value").html(jsonResult.value);

                    $("#slider").val(jsonResult.value);
                    //$("#slider").slider("refresh");
                    //$("#slider").slider("value", jsonResult.value);
                },
                error: function(xhr,status,error){
                    $("#value").html("");
                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
                }
            });
        });






        //-----------------------
        // Refresh graphs
        //-----------------------
        refreshGraphs();
        setInterval(refreshGraphs, 600000);
    });
</script>
</head>
<body>
    <center><h1>Green Wall</h1></center>

    <div id="graphTableDiv"></div>

    <div id="value"></div>

    <div id="errormessage"></div>

</body>
</html>