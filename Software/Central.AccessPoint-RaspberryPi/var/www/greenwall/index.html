<meta charset="UTF-8" comntent="text/html;charset=utf-8" http-equiv="Content-Type">

<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">

<html>
<head>

    <title>Green Wall</title>

    <style>

        /* camCapture in row */
        * {
            box-sizing: border-box;
        }

        .row {
            display: flex;
        }

        /* Create three equal columns that sits next to each other */
        .column {
            padding: 5px;
        }


        /* General fonts */
        * {
/*            font-family: "Comic Sans MS", "Comic Sans", cursive; */
            font-size: 18px;
        }

        h1 {
            font-size: 40px;
        }

        #dateFilter {
            margin-left: auto;
            margin-right: auto;
        }

        #errormessage {
            color: red;
            font-weight: bold;
        }

        #labelstationid {
            white-space: nowrap;
            font-size: 18pt;
            font-weight: bold;
            -moz-transform: rotate(-90deg);
            -moz-transform-origin: center center;
            -webkit-transform: rotate(-90deg);
            -webkit-transform-origin: center center;
            -ms-transform: rotate(-90deg);
            -ms-transform-origin: center center;
            max-width: 2em;
            display: inline-block;
        }

        button{
            height: 60px;
            vertical-align: top;
        }

        .chart-canvas{
            min-height:auto;
            width: 100%;
            background-color: rgb(152, 251, 152);
            padding: 0px;
            border: 1px solid;
/*            border-color: transparent; */
/*            display: block; */
/*            box-sizing: border-box; */
/* display: flex; */
/* flex-grow:1; */
        }

//        #refreshChartButton{
//            height: 60px;
//            vertical-align: top;
//        }

        /* CAM title aligned to center */
        .cam-img-title {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size:1.5em;
        }

        /* CHART title aligned to center */
        .chart-img-title {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size:1.5em;
        }

        /* CAM containder for tables to be flex  */
        .flex-cam-container {
            display: flex;
            flex-wrap: wrap;
            ppadding: 5px;  
            justify-content: flex-start;
        }

        /* CHART containder for tables to be flex  */
        .flex-chart-container {
            display: flex;
            flex-wrap: wrap;
            padding: 5px;  
            justify-content: flex-start;
        }

        /* 3 pictures per line on normal screen with adaptive size */
        .flex-cam-item {
            mmargin: 5px;
            width: 33.3%;
        }

        /* 3 charts per line on normal screen with adaptive size */
        .flex-chart-item {
            mmargin: 5px;
            padding: 2px;
            width: 33.3%;
        }

        /* 1 picture/chart per line on vertical mobile with adaptive size */
        @media (max-width: 600px) {
            .flex-cam-item {
                float: none;
                width: 100%;
            }
        }

        /* 1 picture/chart per line on vertical mobile with adaptive size */
        @media (max-width: 900px) {
            .flex-chart-item {
                float: none;
                width: 100%;
            }
        }

    </style>

    <!-- Chart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

    <!-- JQuery -->
    <script src="script/jquery/jquery-3.6.0.min.js"></script>
    <script src="script/jquery-ui/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="script/jquery-ui/jquery-ui.css">

    <!-- Switch -->
    <script src="script/switch/lc_switch.js"></script>

    <!-- moment -->
    <script src="script/moment/moment.js"></script>

    <!-- favicon -->
    <link rel="shortcut icon" href="favicon.ico">

    <script>

        var levelData = [];
        var temperatureData = [];
        var humidityData = [];

        var camCaptureList = [];

        var chartRefreshIntervalId = null;
        var camCaptureRefreshIntervalId = null;
        var checkLampStatusRefreshIntervalId = null;
        var checkPumpStatusIntervalId = null;
//        var checkMakeVideoStatusIntervalId = null;

        $( function() {
            $( "#tabs" ).tabs();
        } );

        function isEmpty(str) {
            return (!str || str.length === 0 );
        }

        // =============================
        //
        // Construct Cam Capture Section
        //
        // =============================
        function constructCamCaptureSection(){

            $.ajax({type: "GET", url: "/cam/captureList", async: true,
                success: function(result){

                    res = result.result

                    if(res == "OK"){

                        newCamCaptureList = [];
                        $.map(result.camCaptureList, function(camCapture){

                            camId = camCapture.camId;
                            camCaptureUrl = camCapture.captureUrl;

                            cc = {};
                            cc['camId'] = camId;
                            cc['camCaptureUrl'] = camCaptureUrl;
                            newCamCaptureList.push(cc);
                        });

                        newCamCaptureList.sort(function(a, b){return a.camId > b.camId});

                        //If the old and new list is the same, does not need to re-build the camCaptureDiv
                        if( newCamCaptureList.length === camCaptureList.length && newCamCaptureList.every(function(value, index) { return value.camId === camCaptureList[index].camId }) ){
                            return;
                        }

                        divCam = $('<div id="camCaptureDiv" class="flex-cam-container">');

                        camCaptureList = newCamCaptureList;
                        $.map(camCaptureList, function(camCapture){

                            camId = camCapture.camId;
                            camCaptureUrl = camCapture.captureUrl;

                            //
                            // TITLE
                            //
                            title=$('<div class="cam-img-title" style="font-size:1.5em">');
                            title.html(camId);

                            //
                            // IMG
                            //
                            var img = $('<img id="cam_' + camId + '">');

                            // Random value after the image name helps to ignore the cache at refresh
                            img.attr('src', '/greenwall/cam-capture/capture_' + camId + '.jpg?' + Math.random());
                            img.attr('style', 'width: 100%;')

                            //
                            // Build up the Table
                            //
                            var tableBody = $("<tbody>");

                            row = $('<tr>');
                            rowData = $('<td style="padding:0px">');
                            row.append(rowData);
                            rowData = rowData.append(title);
                            row.append(rowData);
                            tableBody.append(row);

                            row = $('<tr>');
                            rowData = $('<td style="padding:0px">');
                            row.append(rowData);
                            rowData = rowData.append(img);
                            row.append(rowData);
                            tableBody.append(row);

                            camTable = $('<table class="flex-cam-item" border="0"></table>');
                            camTable.append(tableBody);
                            divCam.append(camTable);

                        });

                        $('#tabs-cam').html("");
                        $('#tabs-cam').append(divCam);

                        //
                        // Add click event listner to all pictures
                        //
                        $.map(camCaptureList, function(camCapture){

                            camId = camCapture.camId;
                            $("#cam_" + camId).on("click", function(e){

                                // Open window - parameter is the camId
                                // I can not put here simple the camId because it always will be the latest selected value
                                // So I just substring it from the <img id>
                                // The click will be executed on <img> so the 'this' value will refer to the <img>
                                // In the function I will substring the camId value from the parameter
                                openWindow(this.id);
                            });
                        });

                        //
                        // Add click event listner to all MakeVideo  buttons
                        //
/*                        $.map(camCaptureList, function(camCapture){

                            camId = camCapture.camId;

                            $("#buttonMakeVideo_" + camId).on("click", function(e){

                                // Incactivate all MakeVideo buttons
                                inactivateAllMakeVideoButtons();

                                // Make video - parameter is the camId
                                // I can not pass here simple the camId because it always will be the latest selected value
                                // So I just substring it from the <button id>
                                // The click will be executed on <button> so the 'this' value will refer to the <button>
                                // In the function I will substring the camId value from the parameter
                                makeVideo(this.id);
                            });
                        });
*/

                    }else{
                        //$("#value").html("");
                        //$("#errormessage").html("something went wrong");
                        //$("#spinner").hide();
                    }

//                    $("#errormessage").html("");
                },
                error: function(xhr,status,error){
//                    $("#value").html("");
//                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
//                    $("#spinner").hide();
                }
            });
        }


        // =========================================================================================================================
        //
        // Open Capture Window
        //
        // That part if pretty tricky
        // The imgId is the <img id> of the capture image which looks like this: cam_4
        // So I have to substring it to get the camId
        //
        // Then I have to provide this camId to the new window, which I will open
        // I provide it through the window name
        // Solving this problem I tried to dynamically construct that page here and put it into the opened page when it is loaded
        // Unfortunatelly this event listener does not work for Chrome. It worked for Firefox though.
        //
        // Plus I had to solve the problem to NOT to open the already opened cam's window, BUT still have to select it
        //
        // ========================================================================================================================
        function openWindow(imgId){
            var camId = imgId.substring(4);
            var url = 'capture.html';

            var newWindow = window.open('', camId, '');
            if(newWindow.location.href === 'about:blank'){
                newWindow.location.href = url;
            }else{
                newWindow.focus();
            }
        }

        // ============================================================================
        //
        // Inactivate ALL MakeVideo buttons
        //
        // Besides of button inactivation, it will setInterval() for checking the status
        // of the process of the MakeVideo continously.
        // When the MakeVideo status is NOT IN PROGRESS then it will enable the buttons 
        // again, stops the check and refresh the video
        //
        // ============================================================================
/*        function inactivateAllMakeVideoButtons(){

            // Inactivate all MakeVideo buttons
            $('[id^="buttonMakeVideo_"]').prop('disabled', true);

            // Start to check the status of the process of MakeVideo
            checkMakeVideoStatusIntervalId = setInterval(checkMakeVideoStatus, 3000);
        }
*/
        // ============================================================================
        //
        // Activate ALL MakeVideo buttons
        //
        // Besides of button Activation, it will clearInterval() for checking the status
        // of the process of the MakeVideo continously.
        //
        // ============================================================================
/*        function activateAllMakeVideoButtons(){

            // Stop to check the status of the process of MakeVideo
            clearInterval(checkMakeVideoStatusIntervalId);

            // Activate all MakeVideo buttons
            $('[id^="buttonMakeVideo_"]').prop('disabled', false);

            // Refresh the video
            refreshAllVideos();

        }
*/
        // ========================================
        //
        // Refressh all videos
        //
        // ========================================
/*        function refreshAllVideos(){

            videoControlList = $('[id^="videoControl_"]');

            $.each(videoControlList, function( index, videoControl ) {

                videoControlId = videoControl.id;
                var camId = videoControlId.substring(13);

                // This part is not understandable for me
                // You have to set the source in the VideoControl <video> element NOT in the <source> element
                //videoSource = $("#videoSource_" + camId);

                videoSource = videoControl.firstChild;
                videoSource.src = 'cam-video/' + camId + '/video.webm?' + Math.random();

                //videoControl.src = '/greenwall/cam-video/' + camId + '/video.webm?' + Math.random();
//                videoControl.src = 'cam-video/' + camId + '/video.webm?' + Math.random();

                videoControl.load();
            });
        }
*/

        // ========================================
        //
        // Check the status of the MakeVideo
        //
        //
        // If it is NOT IN PROGRESS, then it will 
        // -stop the check 
        // -enable the bottons
        // -refresh the videos
        //
        // ========================================
/*        function checkMakeVideoStatus(){
            $.get( "/cam/video/status" ).done(
                function( data ) {

                    if(data.result == "OK" && data.inProgress){

                        progress = data.progress;
                        camId = data.camId;

console.log(100*progress);
                    }else{
                        activateAllMakeVideoButtons()
                    }
            });
        }
*/

        // =====================================================================================================
        //
        // Make Video
        //
        // The parameter is pretty tricky
        // The buttonId is the <button id> of the 'create video' button which looks like this: buttonMakeVideo_4
        // So I have to substring it to get the camId
        //
        // =====================================================================================================
/*        function makeVideo(buttonId){

            var camId = buttonId.substring(16);

            var startDate = moment().subtract(15, 'minute').format("YYYY-MM-DDTHH:mm:ssZ");

            // The saved files have NO miliseconds, so I omit it here as well
            var endDate = moment().format("YYYY-MM-DDTHH:mm:ssZ");
            var fps = "1";

            $.ajax({type: "POST", url: "/cam/video/construct", 
                    async: false,
                    data: {
                        "camId": camId,
                        "startDate": startDate,
                        "endDate": endDate,
                        "fps": fps
                    },
                    indexValue: {camId:camId}, 
                    success: function(result){

                        res = result.result;

                        if(res == "OK"){

//                            captureUrl = result.captureUrl;
//                            camId = this.indexValue.camId;

                            // Random value after the image name helps to ignore the cache at refresh
//                            $("#cam_" + camId).attr('src', captureUrl + "?" + Math.random());

                        }else{
                            console.error("Make Video ERROR:" + error);
                        }
                    },
                    error: function(xhr,status,error){
                        console.error("Make Video ERROR:" + error);
                    }
            });
        }

*/

        // ================================================
        //
        // Refresh Cam Capture
        //
        // ================================================
        function refreshCamCapture(){
            constructCamCaptureSection();

            $.map(camCaptureList, function(camCapture){

                camId = camCapture.camId;
                //camCaptureUrl = camCapture.captureUrl;

                // Random value after the image name helps to ignore the cache at refresh
                $("#cam_" + camId).attr('src', '/greenwall/cam-capture/capture_' + camId + '.jpg?' + Math.random());

//                $.ajax({type: "GET", url: "/cam/capture/url/camId/" + camId,
//                    async: true,
//                    indexValue: {camId:camId},
//                    success: function(result){
//
//                        res = result.result;
//
//                        if(res == "OK"){
//
//                            captureUrl = result.captureUrl;
//                            camId = this.indexValue.camId;
//
//                            // Random value after the image name helps to ignore the cache at refresh
//                            $("#cam_" + camId).attr('src', captureUrl + "?" + Math.random());
//
//                        }else{
//                            console.log("ERROR:" + error);
//                        }
//                    },
//                    error: function(xhr,status,error){
//                        console.log("ERROR:" + error);
//                    }
//                });
            });
        }

        // ================================================
        //
        // Construct a Chart Canvas
        //
        // ================================================
        function constructChartCanvas(chartCanvasId, title, labelY){
//            var myChart = new Chart(document.getElementById(chartCanvasId), {
            myChart = new Chart($("#" + chartCanvasId), {

                type: 'scatter',
                data: {
                    datasets: [
                    ]
                },
                options: {
                    aspectRatio:1.5,
                    plugins:{
                        title: {
                            display: true,
                            text: title
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true
                            }
                        },
                    },
                    responsive: true,
                    scales: {
                        x: {
                            grid: {
                                borderWidth: 2,
                                borderColor: '#000000',
                            },

                            type: 'time',
                            //distribution: 'series',
                            time: {
                                //unitStepSize: 10,
                                //parser: 'yy.MM.dd',
                                unit: 'day',
                                tooltipFormat: 'yyyy.MM.dd HH:mmzzz',
                                displayFormats: {
                                    'hour': 'HH:mmzzz',
                                    'day': 'yyyy.MM.dd',
                                    'week': 'yyyy.MM.dd',
                                    'month': 'yyyy.MM',
                                    'quarter': 'yyyy.MM',
                                    'year': 'yyyy',
                                },
                            },
                            title: {
                                display: false,
                                text: 'Date',
                            },
                            ticks: {

                                // Bold on Sunday
                                font:{
                                    weight: (c) => {
                                        day = new Date(c.tick.value).getDay()
                                        return day == 0 ? 'bold' : 'normal';
                                    }
                                },

                                display: true,
                                minRotation: 20,
                                align: 'center',

                                    //major: {
                                    //   font: 'bold',
                                    //   enabled: false,
                                    //   unit: 'day',
                                    //   fontColor: 'red',
                                    //   unitStepSize: 2,
                                    //   displayFormats: {
                                    //      'day': 'yyyy.MM.dd',
                                    //      'hour': 'yyyy'
                                    //   },
                                    //},

                                // Red color on Sunday
                                color: (c) => {
                                    day = new Date(c.tick.value).getDay()
                                    return day == 0 ? 'red' : 'black';
                                }

                                //callback: function(value, index, ticks) {
                                //   ticks.forEach(t => {
                                //      const day = new Date(t.value).getDay();
                                //      t.major = (day == 0 || day == 6);
                                //   });
                                //   return '$' + value;
                                //}

                            },
                        },
                        y: {
                            grid: {
                                borderWidth: 2,
                                borderColor: '#000000',
                                display: true,
                            },

                            beginAtZero: true,
                            display: true,
                            ticks: {
                                display: true,
                                //stepSize: 10,
                            },
                            title: {
                                display: true,
                                text: labelY
                            },
                        }
                    },
                }
            });
            return myChart;
        }

        // ================================================
        //
        // Refresh Charts
        //
        // ================================================
        function refreshCharts(){

            $("#spinner").show();

            // Fetch the date values from the fields
            startDate = $('#startDatePicker').val();
            endDate = $('#endDatePicker').val();

            if (!isEmpty(endDate)){
                // Add 1 more day construct midnight of endDate
                var date = new Date(endDate);
                date.setDate(date.getDate() + 1)

                endYear = date.getFullYear()
                endMonth = date.getMonth() + 1
                endDay = date.getDate()
            }

            param = "startDate/" + startDate + ( isEmpty(endDate) ? "" : ("/endDate/" + endYear + "-" + endMonth + "-" + endDay))

            $("#errormessage").html("");

            $.ajax({type: "GET", url: "/sensor/data/list/" + param, async: true,
                success: function(result){

                    $("#spinner").hide();

                    res = result.result

                    if(res == "OK"){

                        divChart = $("#chartTableDiv");

                        // -----------
                        //
                        // WATER LEVEL
                        //
                        // -----------

                        //
                        // Water level CHART
                        //
                        levelCanvasId = "levelCanvas";
                        rowData = $('<canvas id="' + levelCanvasId + '" class="chart-canvas">');

                        div = $('<div class="flex-chart-item">');
                        div.append(rowData);
                        divChart.append(div);

                        // -----------
                        //
                        // TEMPERATURE
                        //
                        // -----------

                        //
                        // Temperature CHART
                        //
                        temperatureCanvasId = "temperatureCanvas";
                        rowData = $('<canvas id="' + temperatureCanvasId + '" class="chart-canvas">');

                        div = $('<div class="flex-chart-item">');
                        div.append(rowData);
                        divChart.append(div);

                        // -----------
                        //
                        // HUMIDITY
                        //
                        // -----------

                        //
                        // Humidity CHART
                        //
                        humidityCanvasId = "humidityCanvas";
                        rowData = $('<canvas id="' + humidityCanvasId + '" class="chart-canvas">');

                        div = $('<div class="flex-chart-item">');
                        div.append(rowData);
                        divChart.append(div);

                        // 

                        levelChart=constructChartCanvas(levelCanvasId, "Water Level", "Level [mm]");
                        temperatureChart=constructChartCanvas(temperatureCanvasId, "Temperature", "Temperature [CÂ°]");
                        humidityChart=constructChartCanvas(humidityCanvasId, "Humidity", "Humidity [%]");

                        //
                        // === fill up the data lists for charts === //
                        //

                        var chartColorList = [
                            {line: "#0000FF", fill: "rgba(0,0,255, 0.5)" },
                            {line: "#f542ef", fill: "rgba(245, 66, 239, 0.5)" },
                            {line: "#f59c42", fill: "rgba(246, 156, 66, 0.5)" },
                            {line: "#dd42f5", fill: "rgba(221,66,245, 0.5)" },
                            {line: "#42dbf6", fill: "rgba(66, 219, 246, 0.5)" },
                        ]

                        colorIndex=0;
                        charts = result.data;
                        $.map(charts,function(graph, index){

                            id=index;
                            record=graph.record

                            levelDataList = [];
                            temperatureDataList = [];
                            humidityDataList = [];

                            $.map(record,function(rec){
                                record = {}
                                record.x=new Date(rec.timeStamp*1000);
                                record.y=rec.levelValue;
                                levelDataList.push(record);

                                record = {}
                                record.x=new Date(rec.timeStamp*1000);
                                record.y=rec.temperatureValue;
                                temperatureDataList.push(record);

                                record = {}
                                record.x=new Date(rec.timeStamp*1000);
                                record.y=rec.humidityValue;
                                humidityDataList.push(record);

                            });

                            levelData = {
                                lineTension: 0,
                                label: id,
                                showLine: true,
                                fill: false,
                                borderColor: chartColorList[colorIndex].line,
                                backgroundColor: chartColorList[colorIndex].fill,
                                pointRadius: 2,
                                pointStyle: 'circle',
                                data: levelDataList,
                            };

                            temperatureData = {
                                lineTension: 0,
                                label: id,
                                showLine: true,
                                fill: false,
                                borderColor: chartColorList[colorIndex].line,
                                backgroundColor: chartColorList[colorIndex].fill,
                                pointRadius: 2,
                                pointStyle: 'circle',
                                data: temperatureDataList,
                            };

                            humidityData = {
                                lineTension: 0,
                                label: id,
                                showLine: true,
                                fill: false,
                                borderColor: chartColorList[colorIndex].line,
                                backgroundColor: chartColorList[colorIndex].fill,
                                pointRadius: 2,
                                pointStyle: 'circle',
                                data: humidityDataList,
                            };

                            levelChart.data.datasets.push(levelData);
                            temperatureChart.data.datasets.push(temperatureData);
                            humidityChart.data.datasets.push(humidityData);

                            colorIndex = (colorIndex + 1) % chartColorList.length;

                        });

                        levelChart.update();
                        temperatureChart.update();
                        humidityChart.update();

                    }else{
                        //$("#value").html("");
                        $("#errormessage").html("something went wrong");
                        $("#spinner").hide();
                    }

                    $("#errormessage").html("");
                },
                error: function(xhr,status,error){
                    //$("#value").html("");
                    $("#errormessage").html(xhr.statusText + " " + xhr.responseText);
                    $("#spinner").hide();
                }
            });
        }



        // ================================================
        //
        // check pump status
        //
        // ================================================
        function checkPumpStatus(){
            $.get( "/pump/status").done(
                function( data ) {

                    if (data.status == 'off'){
                        lcs_off("#pumpSwitch");
                    }
            });
        }

        // ================================================
        //
        // check lamp status
        //
        // ================================================
        function checkLampStatus(){
            $.get("/lamp/status").done(
                function( data ) {
                    $("#lampSwitch").off('lcs-on lcs-off');

                    if (data.status == 'off'){
                        lcs_off("#lampSwitch");
                    }else{
                        lcs_on("#lampSwitch");
                    }

                    $("#lampSwitch").on('lcs-on', lampOnEvent);
                    $("#lampSwitch").on('lcs-off', lampOffEvent);
            });



        }

        // ================================================
        //
        // Lamp ON/OFF Event
        //
        // ================================================
        function lampOnEvent(){
            $.post( "/lamp/switch", { "status": "on", "lengthInSec": "10" } );
        }

        function lampOffEvent(){
            $.post( "/lamp/switch", { "status": "off", "lengthInSec": "10" } );
        }

        // ================================================
        //
        // Pump ON/OFF Event
        //
        // ================================================
        function pumpOnEvent(){

            lcs_disable("#pumpSwitch");

            //first check the state of the pump
            $.get( "/pump/status").done(
                function( data ) {

                    //if the pump is OFF
                    if (data.status == 'off'){

                        //the pump can be turn ON
                        $.post( "/pump/turnOn", { "lengthInSec": "30" } );
                    }
                    checkPumpStatusIntervalId = setInterval(checkPumpStatus, 5000);

                    //console.log("checkPumpStatusIntervalId: " + checkPumpStatusIntervalId);

                    lcs_enable("#pumpSwitch");
                }
            );
        }

        function pumpOffEvent(){

            $.post( "/pump/turnOff" );
            clearInterval(checkPumpStatusIntervalId);

            //console.log("end of interval check. checkPumpStatusIntervalId: " +  checkPumpStatusIntervalId);
            //console.log(" ");
        }

        // ================================================
        // ================================================
        //
        //  When the page is loaded
        //
        // ================================================
        // ================================================
        $(document).ready(function(){

            $("#spinner").hide();

            //-----------------------
            // Start Date
            //-----------------------
            $( "#startDatePicker" ).datepicker({
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: true,
                changeHour: true,
            });

            var date = new Date();
            var weekBefore = new Date(date.getFullYear(), date.getMonth(), date.getDate() - 7);
            $('#startDatePicker').datepicker('setDate', weekBefore);

            //-----------------------
            // End Date
            //-----------------------
            $( "#endDatePicker" ).datepicker({
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: true,
                changeHour: true,
            });

            //-----------------------
            // Refresh Chart Button
            //-----------------------
            $("#refreshChartButton").click(function(){
                //startDate = $('#startDatePicker').val();
                //var date = new Date(startDate);
                //startYear = date.getFullYear()
                //startMonth = date.getMonth() + 1
                //startDay = date.getDate()
                //console.log( startYear + "." + startMonth + "." + startDay);

                $("#spinner").show();

                refreshCharts();
            });

            constructCamCaptureSection();
//            inactivateAllMakeVideoButtons();

            //-----------------------
            // Lamp Switch
            //-----------------------

            lc_switch("#lampSwitch", {

                on_txt      : 'ON',
                off_txt     : 'OFF',
                on_color    : false,
                compact_mode: false
            });

            lcs_disable("#lampSwitch");

            $.get( "/lamp/status").done(
                function( data ) {
                    if (data.status == 'on'){
                        lcs_on("#lampSwitch")
                        lcs_enable("#lampSwitch");
                    }else{
                        lcs_off("#lampSwitch")
                        lcs_enable("#lampSwitch");
                    }

                    $("#lampSwitch").on('lcs-on', lampOnEvent);
                    $("#lampSwitch").on('lcs-off', lampOffEvent);
                }
            );

            //-----------------------
            // Pump Switch
            //-----------------------

            lc_switch("#pumpSwitch", {

                on_txt      : 'ON',
                off_txt     : 'OFF',
                on_color    : false,
                compact_mode: false
            });

            lcs_disable("#pumpSwitch");

            $.get( "/pump/status").done(
                function( data ) {
                    if (data.status == 'on'){
                        lcs_on("#pumpSwitch")
                        lcs_enable("#pumpSwitch");

                        // 5 sec
                        checkPumpStatusIntervalId = setInterval(checkPumpStatus, 5000);
                        //console.log("initial checkPumpStatusIntervalId: " + checkPumpStatusIntervalId);

                    }else{
                        lcs_off("#pumpSwitch")
                        lcs_enable("#pumpSwitch");
                    }

                    $("#pumpSwitch").on('lcs-on', pumpOnEvent);
                    $("#pumpSwitch").on('lcs-off', pumpOffEvent);
                }
            );

            //-----------------------
            // Tab
            //-----------------------
            $( "#tabs" ).tabs({

                // Initial TAB = Control-Tab
                active: 0

            });

            $(".ui-tabs .ui-tabs-panel").css('padding', '0em');


            //-----------------------
            // Refresh Lamp Status
            //-----------------------
            checkLampStatusRefreshIntervalId = setInterval(checkLampStatus, 5000);

            $( "#tabs" ).tabs({
               activate: function( event, ui ) {

                    // Leave Control-Tab
                    if(ui.oldTab.index() == 0){

                        // No more Check Lamp Status request
                        clearInterval(checkLampStatusRefreshIntervalId);

                    // Leave Chart-Tab
                    }else if(ui.oldTab.index() == 1){

                        // No more Chart refresh request
                        clearInterval(chartRefreshIntervalId);

                    // Leave Cam-Tab
                    }else if( ui.oldTab.index() == 2){

                        // No more Cam Capture request
                        clearInterval(camCaptureRefreshIntervalId);

                    }

                    //
                    // Select Control-Tab
                    //
                    if(ui.newTab.index() == 0){

                        //-----------------------
                        // Refresh Lamp Status
                        //-----------------------
                        checkLampStatusRefreshIntervalId = setInterval(checkLampStatus, 5000);

                    // Select Chart-Tab
                    }else if(ui.newTab.index() == 1){

                        //-----------------------
                        // Refresh Charts
                        //-----------------------
                        chartRefreshIntervalId = setInterval(refreshCharts, 600000);

                    // Select Cam-Tab
                    }else if( ui.newTab.index() == 2){

                        //-----------------------
                        // Refresh Cam Capture
                        //-----------------------
                        camCaptureRefreshIntervalId = setInterval(refreshCamCapture, 10000);
                    }
                }
            });




        });

    </script>

</head>

<body style="background-color:DarkGrey;">

    <div class="header" style="position:relative; text-align:center; color:white; text-shadow: 2px 2px 2px green; ">
        <img src="header.jpg" style="width:100%"/>
        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-weight:bolder; font-size:5vw">Green Wall</div>
    </div>

    <div id="tabs" style="background: none repeat scroll 0% 0% rgb(204, 204, 204);">
        <ul>
            <li><a href="#tabs-control">Control</a></li>
            <li><a href="#tabs-charts">Charts</a></li>
            <li><a href="#tabs-cam">Cam</a></li>
        </ul>

        <!--         -->
        <!-- CONTROL -->
        <!--         -->
        <div id="tabs-control">

            <table id="controller" border="0" class="switchh">
                <tr>
                    <td valign="top" >Lamp:</td>
                    <td >
                        <form>
                            <!-- Sliding Toggle Switch -->
                            <input type="checkbox" name="lampSwitch" value="1" class="lcs_check" id="lampSwitch"/>
                        </form>
                    </td>
                </tr>

                <tr>
                    <td valign="top" >Pump:</td>
                    <td >
                        <form>
                            <input type="checkbox" name="pumpSwitch" value="1" class="lcs_check" id="pumpSwitch"/>
                        </form>
                    </td>
                </tr>
            </table>
        </div>

        <!--        -->
        <!-- CHARTS -->
        <!--        -->
        <div id="tabs-charts">

            <table id="dateFilter" border="0">
                <tr>
                    <td> Start date:</td>
                    <td><input type="text" id="startDatePicker" size="8"> </td>
                    <td rowspan="2"><button id="refreshChartButton">Refresh</button></td>
                    <td rowspan="2" width="60px"><img id="spinner" src="spinner.gif" width="60"></td> 
                </tr>
                <tr>
                    <td> End date:</td>
                    <td><input type="text" id="endDatePicker" size="8"> </td>
                </tr>
            </table>

            <div id="chartTableDiv" class="flex-chart-container"></div>

            <div id="errormessage"></div>
        </div>

        <!--     -->
        <!-- CAM -->
        <!--     -->
        <div id="tabs-cam">

<!--            <div id="camCaptureDiv" class="flex-cam-container"></div> -->

<!--            <video width="320" height="240" controls>
                <source src="cam-video/5/video.webm" type="video/webm"> 
            	    Your browser does not support the video tag.
            </video> 
-->

        </div> 


    </div>


</body>
</html>